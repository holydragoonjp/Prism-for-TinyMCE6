!function(){"use strict";let a=tinymce.util.Tools.resolve("tinymce.PluginManager"),b=a=>{let g=a.dom,c=a.selection,b={},d="",h,i="",j,k;a.options.register("prism_languages",{processor:"object[]",default:[{text:"HTML/XML",value:"markup"},{text:"CSS",value:"css"},{text:"C-like",value:"clike"},{text:"JavaScript",value:"javascript"}]});let e=a.options.get("prism_languages"),f=c.getContent({format:"text"});b.code=f,""==b.code&&(d="<br>"),"&nbsp;"==b.code&&(b.code=""),a.windowManager.open({title:"Prism - Code Editor",minWidth:450,body:{type:"panel",items:[{type:"selectbox",name:"language",label:"Select language",items:e,flex:!0},{type:"textarea",name:"code",minHeight:200,multiline:!0,placeholder:"Please insert your code."},{type:"checkbox",name:"linenumber",label:"Line Number"},{type:"grid",columns:2,items:[{type:"input",name:"firstline",label:"First Line",disabled:!1},{type:"input",name:"highlight",label:"Highlight",disabled:!1},]},]},initialData:{code:b.code,linenumber:!0},onChange(a){let b=a.getData();a.setEnabled("firstline",b.linenumber),a.setEnabled("highlight",b.linenumber)},onSubmit(b){if(""===b.getData().code){a.windowManager.alert("Please insert your code.");return}{let c=b.getData().code;c=c.replace(/\</g,"&lt;").replace(/\>/g,"&gt;").replace(/ã€€{4}/g,"	");let l=b.getData().language?b.getData().language:"markup",e=b.getData().firstline?b.getData().firstline:"",m=!!b.getData().linenumber&&b.getData().linenumber,f=b.getData().highlight?b.getData().highlight:"";h=g.create("code",{class:"language-"+l},c),m&&(i=' class="line-numbers"'),""!=e&&(j=' data-start="'+e+'"'),""!=f&&(k=' data-line="'+f+'"'),""==i?a.execCommand("mceInsertContent",!1,"<pre>"+g.getOuterHTML(h)+"</pre>"+d):a.execCommand("mceInsertContent",!1,"<pre"+i+j+k+">"+g.getOuterHTML(h)+"</pre>"+d),b.close()}},buttons:[{text:"Close",type:"cancel",onclick:"close"},{text:"Insert",type:"submit",primary:!0}]})},c=a=>{a.ui.registry.addToggleButton("prism",{icon:"code-sample",tooltip:"Insert code with Prism",onAction(){let e=a.selection,c=e.getNode();if("code"===c.nodeName.toLowerCase()){let d=$(c).unwrap().text();d=d.replace(/\</g,"&lt;").replace(/\>/g,"&gt;").replace(/\n{2}/g,"<p>").replace(/\n/g,"<br>").replace(/ /g,"&nbsp;").replace(/\t/g,"\u3000\u3000\u3000\u3000"),e.setContent(d),c.remove()}else b(a)},onSetup(c){let b=a=>{c.setActive("code"===a.element.nodeName.toLowerCase())};return a.on("NodeChange",b),()=>{a.off("NodeChange",b)}}})};a.requireLangPack("prism"),a.add("prism",a=>(c(a),{getMetadata:()=>({name:"Prism",url:"https://github.com/holydragoonjp/Prism-for-TinyMCE6"})}))}()